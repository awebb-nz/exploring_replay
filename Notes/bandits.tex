\documentclass{article}

\usepackage[margin=1in]{geometry}
\usepackage{amsmath, amsfonts}
\usepackage{hyperref}
\setlength{\parindent}{0pt}

\begin{document}
    
Change in the value function due to learning after taking action $a^*$:

\begin{align}
v(ba^*)-v(b)=&\sum_{b'}p(b'\mid b, a^*)\sum_a \pi(a\mid b')q(b', a)-\sum_{a} \pi(a\mid b)q(b,a)\\
=&\sum_a\big(\sum_{b'}p(b'\mid b, a^*) \pi(a\mid b')q(b', a)-\pi(a\mid b)q(b,a)\big) \nonumber \\
=&\sum_a\big(\sum_{b'}p(b'\mid b, a^*) \pi(a\mid b')q(b', a)-\pi(a\mid b)q(b,a) \nonumber \\
+&\pi(a\mid b)\sum_{b'}p(b'\mid b, a^*)q(b', a) - \pi(a\mid b)\sum_{b'}p(b'\mid b, a^*)q(b', a)\big) \nonumber \\
=&\sum_a\big(\sum_{b'}p(b'\mid b, a^*)\big(\pi(a\mid b')-\pi(a\mid b)\big)q(b',a) \nonumber \\
+&\pi(a\mid b)\sum_{b'}p(b'\mid b, a^*)\big(q(b', a) - q(b, a)\big)\big)\nonumber \\
=&\sum_{b'}p(b'\mid b, a^*)\sum_a\big(\big(\pi(a\mid b')-\pi(a\mid b)\big)q(b',a) \nonumber \\
+&\pi(a\mid b)\big(q(b', a) - q(b, a)\big)\big)\nonumber \\
\end{align}

\begin{align}
q(b', a)-q(b, a)=&\sum_{b''}p(b''\mid b', a)\big[r(b',a) + \gamma v(b'')\big]\\
-&\sum_{b'}p(g'\mid b, a)\big[r(b,a) + \gamma v(b')\big]\nonumber\\
=& r(b',a) + \gamma \sum_{b''}p(b''\mid b', a)v(b'')\nonumber \\
-& r(b,a) + \gamma \sum_{b'}p(b'\mid b, a)v(b')\nonumber \\
=& \underbrace{\vphantom{ \left(\frac{a^{\frac{0.3}{`}}}{b}\right)} r(b',a) - r(b,a)}_{\substack{\text{Difference in the expected} \\ \text{immediate return}}} + \underbrace{\gamma \big[ \sum_{b''}p(b''\mid b', a)v(b'') - \sum_{b'}p(b'\mid b, a)v(b') \big]}_{\substack{\text{Difference in the expected} \\ \text{future return}}}\nonumber
\end{align}

\end{document}
